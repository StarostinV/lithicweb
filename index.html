<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Annotation Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href= "https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
<script>
    window.debugGlobalVar = {}; // Declare a global debug object
</script>
<div class="fixed top-0 left-0 right-0 bg-white shadow-lg z-10 p-4 flex justify-between items-center">
    <div class="flex items-center space-x-2">
        <button id="showDoc" class="bg-green-200 text-green-800 px-4 py-2 rounded hover:bg-green-300" title="Show Documentation">
            <i class="fas fa-book"></i>
        </button>
        <label for="fileInput" class="file-input-label" title="Choose a PLY or MAT file to upload">Choose File</label>
        <input type="file" id="fileInput" accept=".ply,.mat" class="hidden-file-input">
        <span id="fileName" class="text-gray-700"></span>
    </div>
    <div class="flex space-x-2">
        <button id="viewPanelBtn" class="toggle-button bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to View Mode">View</button>
        <button id="drawPanelBtn" class="toggle-button bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to Draw Mode">Draw</button>
        <button id="arrowPanelBtn" class="toggle-button bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to Erase Mode">Arrows</button>
        <button id="modelPanelBtn" class="toggle-button bg-purple-300 text-purple-800 px-4 py-2 rounded hover:bg-purple-400" title="AI Model Inference">Model</button>
        <button id="historyPanelBtn" class="toggle-button bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="View History">History</button>
        <!-- <button id="invertNormals" class="toggle-button bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Invert Normals">Invert normals</button> -->        
        <button id="updateLight" class="bg-yellow-200 text-yellow-800 px-4 py-2 rounded hover:bg-yellow-300" title="Update Light Direction">
            <i class="fas fa-lightbulb"></i>
        </button>
        <button id="exportAnnotations" class="bg-blue-200 text-blue-800 px-4 py-2 rounded hover:bg-blue-300" title="Export Annotations">
            <i class="fas fa-download"></i>
        </button>
    </div>
</div>
    <div class="pt-20">
        <canvas id="renderCanvas" class="w-full h-screen"></canvas>
    </div>

    <!-- Floating Undo/Redo buttons for tablet users -->
    <div style="position: fixed; bottom: 24px; left: 50%; transform: translateX(-150%); z-index: 100; pointer-events: none;">
        <div class="flex items-center space-x-8 select-none" style="pointer-events: auto;">
            <button id="floatingUndoBtn"
              class="text-gray-500 hover:text-white transition-transform hover:scale-110 disabled:opacity-30 disabled:cursor-not-allowed p-2"
              title="Undo (Ctrl+Z)" disabled>
              <i class="fas fa-undo fa-2x"></i>
            </button>
            <button id="floatingRedoBtn"
              class="text-gray-500 hover:text-white transition-transform hover:scale-110 disabled:opacity-30 disabled:cursor-not-allowed p-2"
              title="Redo (Ctrl+Shift+Z)" disabled>
              <i class="fas fa-redo fa-2x"></i>
            </button>
        </div>
    </div>
                        <div id="sideMenu" class="side-menu">
        <div id="sideMenuResizeHandle" class="side-menu-resize-handle"></div>
        <div id="viewPanel" class="panel">
            <h2 class="text-xl font-bold mb-4">View Mode</h2>
            <div class="flex flex-col space-y-2">
                <p class="text-sm text-gray-700">Hold left-click to rotate the camera.</p>
                <p class="text-sm text-gray-700">Hold right-click to move the camera.</p>
                <button id="viewMode" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to View Mode"
                style="display: none;">View</button>
                <p>Direct light intensity: <span id="sliderLightValue"></span></p>
                <div id="sliderLight"></div>
                <p>Ambient light intensity: <span id="sliderAmbientLightValue"></span></p>
                <div id="sliderAmbientLight"></div>

                <button id="updateLight2" class="bg-yellow-200 text-yellow-800 px-4 py-2 rounded hover:bg-yellow-300" title="Update Light Direction">
                    <i class="fas fa-lightbulb"></i> Set Light Direction
                </button>
        

                <button id="invertNormals" class="bg-blue-200 text-blue-800 px-4 py-2 rounded hover:bg-blue-400" title="Invert Normals of the mesh">
                    <i class="fas fa-exchange-alt"></i>   Invert Normals
                </button>
        
            </div>
        </div>
        <div id="drawPanel" class="panel hidden">
            <h2 class="text-xl font-bold mb-4">Edge Annotation</h2>
            <div class="flex flex-col space-y-2">
                <p class="text-sm text-gray-700">Hold left-click to draw continuously.</p>
                <p class="text-sm text-gray-700">Hold Alt to go to view mode.</p>
                <button id="drawMode" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to Draw Mode">Draw</button>
                <button id="drawLinesMode" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to Draw Mode">Draw lines (Right click to stop)</button>
                <button id="eraseMode" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to Erase Mode">Erase</button>  
                <button id="useBrush" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Use brush">Enable brush</button>
                <p id="sliderBrushSizeLabel">Brush size: <span id="sliderBrushSizeValue"></span></p>
                <div id="sliderBrushSize"></div>

            </div>
            <h2 class="text-xl font-bold mb-4">Segmentation</h2>
            <div class="flex flex-col space-y-2">
                <div class="flex items-center gap-2">
                    <div class="auto-seg-toggle-container">
                        <input type="checkbox" id="show-segments" checked />
                        <span class="auto-seg-slider auto-seg-round"></span>
                    </div>
                    <span class="text-sm text-gray-700">Show segmentation</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="auto-seg-toggle-container">
                        <input type="checkbox" id="auto-segments" checked />
                        <span class="auto-seg-slider auto-seg-round"></span>
                    </div>
                    <span class="text-sm text-gray-700">Auto segmentation</span>
                </div>
                <button id="update-segments" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Update segmentation">Update segmentation</button>
                <button id="update-segment-colors" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Update segmentation colors">Update face colors</button>
            </div>
        </div>
        <div id="arrowPanel" class="panel hidden">
            <h2 class="text-xl font-bold mb-4">Arrow Annotation</h2>
            <div class="flex flex-col space-y-2">
                <button id="arrowMode" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to Erase Mode">Draw Arrows</button>
                <button id="deleteArrowsMode" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" title="Switch to Delete Arrows Mode">Delete arrows</button>
            </div>

        </div>
        <div id="historyPanel" class="panel hidden">
            <h2 class="text-xl font-bold mb-4">History</h2>
            <div class="flex flex-col space-y-2">
                <div class="flex space-x-2 mb-2">
                    <button id="undoBtn" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed" title="Undo (Ctrl+Z)" disabled>
                        <i class="fas fa-undo"></i> Undo
                    </button>
                    <button id="redoBtn" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed" title="Redo (Ctrl+Shift+Z)" disabled>
                        <i class="fas fa-redo"></i> Redo
                    </button>
                </div>
                <button id="clearHistoryBtn" class="bg-red-200 text-red-800 px-4 py-2 rounded hover:bg-red-300" title="Clear all history">
                    <i class="fas fa-trash"></i> Clear History
                </button>
                <div class="text-xs text-gray-600 mt-2">
                    <span id="historyStats">History: 0 actions</span>
                </div>
                <div class="border-t pt-2 mt-2 flex-1 flex flex-col min-h-0">
                    <h3 class="text-sm font-semibold mb-2">Action History</h3>
                    <div id="historyList" class="space-y-1 overflow-y-auto flex-1">
                        <p class="text-sm text-gray-500 italic">No actions yet</p>
                    </div>
                </div>
            </div>
        </div>
        <div id="modelPanel" class="panel hidden">
            <h2 class="text-xl font-bold mb-4"><i class="fas fa-brain"></i> AI Model</h2>
            <div class="flex flex-col space-y-3">
                <!-- Connection Status -->
                <div class="flex items-center justify-between">
                    <span id="connectionStatus" class="text-sm text-red-700">
                        <i class="fas fa-circle text-red-500"></i> Not configured
                    </span>
                    <button id="modelSettingsBtn" class="bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300 text-sm" title="Server Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>

                <!-- Current Mesh -->
                <div class="border-t pt-3">
                    <h3 class="text-sm font-semibold mb-2">Data</h3>
                    <button id="uploadToServerBtn" class="w-full bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm" title="Upload current mesh and prepare for inference">
                        <i class="fas fa-upload"></i> Upload & Prepare
                    </button>
                    <p class="text-xs text-gray-500 mt-1">Sends current mesh to server for processing</p>
                </div>

                <!-- Inference Configuration -->
                <div class="border-t pt-3">
                    <h3 class="text-sm font-semibold mb-2">Configuration</h3>
                    <div id="configContainer" class="space-y-2">
                        <!-- Config inputs will be generated here -->
                    </div>
                </div>

                <!-- Inference Actions -->
                <div class="border-t pt-3">
                    <button id="runInferenceBtn" class="w-full bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600" title="Run AI inference and apply results">
                        <i class="fas fa-brain"></i> Run Inference
                    </button>
                </div>

                <!-- Status -->
                <div id="inferenceStatus" class="text-sm p-2 rounded bg-gray-50 text-gray-600">
                    Ready. Configure server settings to begin.
                </div>
            </div>
        </div>
    </div>
    

    <!-- The Modal -->
    <div id="docModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="docContent"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

        // Handle file input change
        document.getElementById('fileInput').addEventListener('change', (event) => {
            const fileNameSpan = document.getElementById('fileName');
            const file = event.target.files[0];
            if (file) {
                fileNameSpan.textContent = file.name;
            } else {
                fileNameSpan.textContent = '';
            }
        });

        // Get the modal
        var modal = document.getElementById("docModal");

        // Get the button that opens the modal
        var btn = document.getElementById("showDoc");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal
        btn.onclick = function() {
            modal.style.display = "flex";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Add markdown content
        const docContent = `
# 3D Mesh Annotation\n\n

## Overview\n
This tool allows you to annotate 3D models and is primarily developed for annotating lithic artifacts. It will be equipped with ML-powered annotaton algorithms in the near future.

## Buttons
- **Choose File**: Upload a .PLY file from your computer for annotating.
- **View Mode**: Allows you to rotate and zoom the 3D model. Hold left-click to rotate, hold right-click to move camera.
- **Draw Mode**: Enables drawing annotations on the 3D model: left-click (hold for continuous drawing).
- **Arrows Mode**: Draw arrows on the 3D model to indicate directions or features.
- **Model**: AI-powered annotation using the LithicServer backend.
- **History**: View and manage your annotation history with undo/redo capabilities.
- **Update Light**: Updates the direction of the light in the scene based on the camera position.
- **Export Annotations**: Exports the annotations to a .PLY file.

## AI Model Inference
The Model panel connects to a LithicServer backend for AI-powered edge detection:
1. Click the gear icon to configure your server URL and API token
2. Create or select an inference session
3. Upload your current mesh to the server
4. Load the mesh data into your session
5. Adjust inference parameters (edge threshold, steps, etc.)
6. Click "Run Inference" to process
7. Click "Apply Results" to add AI predictions as annotations
8. Use Undo/Redo to revert if needed

## History & Undo/Redo
The History panel provides a complete view of all your annotation actions:
- **Undo/Redo**: Use buttons or keyboard shortcuts to undo/redo actions
- **Visual Timeline**: See all actions with timestamps and edge counts
- **Clickable States**: Click any state in the timeline to jump directly to it
- **Current State Indicator**: The active state is highlighted in blue
- **Memory Efficient**: Only stores edge indices, not full mesh data
- **Clear History**: Remove all history to free up memory

## Exported File Format
The exported .PLY file has the standard format with "vertex" and "face" that contains the original mesh. Additionally, it contains 
"labels" - a child property of the "vertex" property.

## Keyboard Shortcuts
- **Ctrl+Z**: Undo last action
- **Ctrl+Shift+Z** or **Ctrl+Y**: Redo last undone action
- Hold **Ctrl** (any mode): use left mouse button to shift the camera
- Hold **Alt** (any mode): use left mouse button to rotate the camera
- Hold **right-click** (any mode): move camera

## Support contact
Vladimir Starostin: [vladimir.starostin@uni-tuebingen.de](mailto:vladimir.starostin@uni-tuebingen.de).

`;
        document.getElementById('docContent').innerHTML = marked.parse(docContent);

        // Sidebar resize functionality
        const sideMenu = document.getElementById('sideMenu');
        const resizeHandle = document.getElementById('sideMenuResizeHandle');
        const STORAGE_KEY_WIDTH = 'lithicjs_sidebar_width';
        
        // Load saved width
        const savedWidth = localStorage.getItem(STORAGE_KEY_WIDTH);
        if (savedWidth) {
            const width = parseInt(savedWidth);
            if (width >= 280 && width <= 600) {
                sideMenu.style.width = width + 'px';
            }
        }
        
        let isResizing = false;
        let startX = 0;
        let startWidth = 0;
        
        resizeHandle.addEventListener('mousedown', (e) => {
            isResizing = true;
            startX = e.clientX;
            startWidth = sideMenu.offsetWidth;
            resizeHandle.classList.add('dragging');
            document.body.style.cursor = 'ew-resize';
            document.body.style.userSelect = 'none';
            e.preventDefault();
        });
        
        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            
            const deltaX = startX - e.clientX;
            let newWidth = startWidth + deltaX;
            
            // Clamp to min/max
            newWidth = Math.max(280, Math.min(600, newWidth));
            sideMenu.style.width = newWidth + 'px';
        });
        
        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                resizeHandle.classList.remove('dragging');
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
                
                // Save width to localStorage
                localStorage.setItem(STORAGE_KEY_WIDTH, sideMenu.offsetWidth);
            }
        });

        // Touch support for resize
        resizeHandle.addEventListener('touchstart', (e) => {
            isResizing = true;
            startX = e.touches[0].clientX;
            startWidth = sideMenu.offsetWidth;
            resizeHandle.classList.add('dragging');
            e.preventDefault();
        });
        
        document.addEventListener('touchmove', (e) => {
            if (!isResizing) return;
            
            const deltaX = startX - e.touches[0].clientX;
            let newWidth = startWidth + deltaX;
            newWidth = Math.max(280, Math.min(600, newWidth));
            sideMenu.style.width = newWidth + 'px';
        });
        
        document.addEventListener('touchend', () => {
            if (isResizing) {
                isResizing = false;
                resizeHandle.classList.remove('dragging');
                localStorage.setItem(STORAGE_KEY_WIDTH, sideMenu.offsetWidth);
            }
        });
    });
    </script>
    <style>
        body {
    overflow: hidden; /* Remove scrolling */
}

.hidden-file-input {
    display: none;
}
.file-input-label {
    display: inline-block;
    background-color: #E2E8F0; /* bg-gray-300 */
    color: #4A5568; /* text-gray-700 */
    padding: 8px 16px; /* px-4 py-2 */
    border-radius: 8px; /* rounded */
    cursor: pointer;
    margin-right: 8px; /* mr-2 */
}
.file-input-label:hover {
    background-color: #CBD5E0; /* hover:bg-gray-400 */
}
.modal {
    display: none; 
    position: fixed; 
    z-index: 50; 
    left: 0; 
    top: 0; 
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgb(0,0,0); 
    background-color: rgba(0,0,0,0.4); 
    justify-content: center;
    align-items: center;
}
.modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}
.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
.modal-content h1, .modal-content h2, .modal-content h3, .modal-content h4, .modal-content h5, .modal-content h6 {
    font-weight: bold;
    margin-top: 1em;
    margin-bottom: 0.5em;
}
.modal-content p {
    margin: 0.5em 0;
}
.modal-content ul, .modal-content ol {
    margin: 1em 0;
    padding-left: 1.5em;
}
.modal-content code {
    background-color: #f5f5f5;
    padding: 0.2em 0.4em;
    border-radius: 4px;
}

/* Default cursor for view mode */
.view-cursor {
    cursor: default;
}

/* Orange circle cursor for draw mode */
.draw-cursor {
    cursor: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSI1IiBzdHJva2U9Im9yYW5nZSIgc3Ryb2tlLXdpZHRoPSI1Ii8+PC9zdmc+'), auto;
}

/* White circle cursor for erase mode */
.erase-cursor {
    cursor: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSI1IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjUiLz48L3N2Zz4='), auto;
}

.side-menu {
    position: fixed;
    top: 72px; /* Account for header height */
    right: 0;
    width: 360px;
    min-width: 280px;
    max-width: 600px;
    height: calc(100vh - 72px); /* Full height minus header */
    background-color: #fff;
    box-shadow: -2px 0 8px rgba(0,0,0,0.15);
    border-radius: 12px 0 0 0;
    display: flex;
    flex-direction: column;
    z-index: 20;
}

.side-menu-resize-handle {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 6px;
    cursor: ew-resize;
    background: transparent;
    transition: background 0.2s;
    z-index: 25;
    border-radius: 12px 0 0 0;
}

.side-menu-resize-handle:hover,
.side-menu-resize-handle.dragging {
    background: linear-gradient(90deg, rgba(99, 102, 241, 0.4) 0%, transparent 100%);
}

.side-menu-resize-handle::before {
    content: '';
    position: absolute;
    left: 1px;
    top: 50%;
    transform: translateY(-50%);
    width: 3px;
    height: 40px;
    background: #d1d5db;
    border-radius: 2px;
    opacity: 0;
    transition: opacity 0.2s;
}

.side-menu-resize-handle:hover::before,
.side-menu-resize-handle.dragging::before {
    opacity: 1;
}

.panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 16px;
    margin: 0;
    width: 100%;
    box-sizing: border-box;
    background-color: #fff;
    overflow-y: auto;
    overflow-x: hidden;
}

.panel > .flex.flex-col,
.panel > div:last-child {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.panel.hidden {
    display: none;
}

/* Custom scrollbar for panels */
.panel::-webkit-scrollbar {
    width: 8px;
}

.panel::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.panel::-webkit-scrollbar-thumb {
    background: #c4c4c4;
    border-radius: 4px;
}

.panel::-webkit-scrollbar-thumb:hover {
    background: #999;
}

/* Panel headers */
.panel h2 {
    font-size: 1.125rem;
    font-weight: 700;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e5e7eb;
    color: #374151;
    flex-shrink: 0;
}

.panel h3 {
    font-size: 0.875rem;
    font-weight: 600;
    color: #4b5563;
    margin-bottom: 0.5rem;
    flex-shrink: 0;
}

/* Ensure config container scrolls if needed */
#configContainer {
    max-height: 220px;
    overflow-y: auto;
    padding-right: 4px;
}

#configContainer::-webkit-scrollbar {
    width: 6px;
}

#configContainer::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#configContainer::-webkit-scrollbar-thumb {
    background: #c4c4c4;
    border-radius: 3px;
}


.noUi-target,.noUi-target *{-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;-ms-touch-action:none;touch-action:none;-ms-user-select:none;-moz-user-select:none;user-select:none;-moz-box-sizing:border-box;box-sizing:border-box}.noUi-target{position:relative}.noUi-base,.noUi-connects{width:100%;height:100%;position:relative;z-index:1}.noUi-connects{overflow:hidden;z-index:0}.noUi-connect,.noUi-origin{will-change:transform;position:absolute;z-index:1;top:0;right:0;height:100%;width:100%;-ms-transform-origin:0 0;-webkit-transform-origin:0 0;-webkit-transform-style:preserve-3d;transform-origin:0 0;transform-style:flat}.noUi-txt-dir-rtl.noUi-horizontal .noUi-origin{left:0;right:auto}.noUi-vertical .noUi-origin{top:-100%;width:0}.noUi-horizontal .noUi-origin{height:0}.noUi-handle{-webkit-backface-visibility:hidden;backface-visibility:hidden;position:absolute}.noUi-touch-area{height:100%;width:100%}.noUi-state-tap .noUi-connect,.noUi-state-tap .noUi-origin{-webkit-transition:transform .3s;transition:transform .3s}.noUi-state-drag *{cursor:inherit!important}.noUi-horizontal{height:18px}.noUi-horizontal .noUi-handle{width:34px;height:28px;right:-17px;top:-6px}.noUi-vertical{width:18px}.noUi-vertical .noUi-handle{width:28px;height:34px;right:-6px;bottom:-17px}.noUi-txt-dir-rtl.noUi-horizontal .noUi-handle{left:-17px;right:auto}.noUi-target{background:#FAFAFA;border-radius:4px;border:1px solid #D3D3D3;box-shadow:inset 0 1px 1px #F0F0F0,0 3px 6px -5px #BBB}.noUi-connects{border-radius:3px}.noUi-connect{background:#3FB8AF}.noUi-draggable{cursor:ew-resize}.noUi-vertical .noUi-draggable{cursor:ns-resize}.noUi-handle{border:1px solid #D9D9D9;border-radius:3px;background:#FFF;cursor:default;box-shadow:inset 0 0 1px #FFF,inset 0 1px 7px #EBEBEB,0 3px 6px -3px #BBB}.noUi-active{box-shadow:inset 0 0 1px #FFF,inset 0 1px 7px #DDD,0 3px 6px -3px #BBB}.noUi-handle:after,.noUi-handle:before{content:"";display:block;position:absolute;height:14px;width:1px;background:#E8E7E6;left:14px;top:6px}.noUi-handle:after{left:17px}.noUi-vertical .noUi-handle:after,.noUi-vertical .noUi-handle:before{width:14px;height:1px;left:6px;top:14px}.noUi-vertical .noUi-handle:after{top:17px}[disabled] .noUi-connect{background:#B8B8B8}[disabled] .noUi-handle,[disabled].noUi-handle,[disabled].noUi-target{cursor:not-allowed}.noUi-pips,.noUi-pips *{-moz-box-sizing:border-box;box-sizing:border-box}.noUi-pips{position:absolute;color:#999}.noUi-value{position:absolute;white-space:nowrap;text-align:center}.noUi-value-sub{color:#ccc;font-size:10px}.noUi-marker{position:absolute;background:#CCC}.noUi-marker-sub{background:#AAA}.noUi-marker-large{background:#AAA}.noUi-pips-horizontal{padding:10px 0;height:80px;top:100%;left:0;width:100%}.noUi-value-horizontal{-webkit-transform:translate(-50%,50%);transform:translate(-50%,50%)}.noUi-rtl .noUi-value-horizontal{-webkit-transform:translate(50%,50%);transform:translate(50%,50%)}.noUi-marker-horizontal.noUi-marker{margin-left:-1px;width:2px;height:5px}.noUi-marker-horizontal.noUi-marker-sub{height:10px}.noUi-marker-horizontal.noUi-marker-large{height:15px}.noUi-pips-vertical{padding:0 10px;height:100%;top:0;left:100%}.noUi-value-vertical{-webkit-transform:translate(0,-50%);transform:translate(0,-50%);padding-left:25px}.noUi-rtl .noUi-value-vertical{-webkit-transform:translate(0,50%);transform:translate(0,50%)}.noUi-marker-vertical.noUi-marker{width:5px;height:2px;margin-top:-1px}.noUi-marker-vertical.noUi-marker-sub{width:10px}.noUi-marker-vertical.noUi-marker-large{width:15px}.noUi-tooltip{display:block;position:absolute;border:1px solid #D9D9D9;border-radius:3px;background:#fff;color:#000;padding:5px;text-align:center;white-space:nowrap}.noUi-horizontal .noUi-tooltip{-webkit-transform:translate(-50%,0);transform:translate(-50%,0);left:50%;bottom:120%}.noUi-vertical .noUi-tooltip{-webkit-transform:translate(0,-50%);transform:translate(0,-50%);top:50%;right:120%}.noUi-horizontal .noUi-origin>.noUi-tooltip{-webkit-transform:translate(50%,0);transform:translate(50%,0);left:auto;bottom:10px}.noUi-vertical .noUi-origin>.noUi-tooltip{-webkit-transform:translate(0,-18px);transform:translate(0,-18px);top:auto;right:28px}

.auto-seg-toggle-container {
    position: relative;
    display: inline-block;
    width: 80px;
    height: 40px;
    pointer-events: none;
    user-select: none;
}

.auto-seg-toggle-container input {
    opacity: 0;
    width: 100%;
    height: 100%;
    pointer-events: all;
}

.auto-seg-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #808080;
    transition: 0.4s;
    pointer-events: none;
}

.auto-seg-slider:before {
    position: absolute;
    content: "";
    height: 24px;
    width: 24px;
    left: 8px;
    bottom: 8px;
    background-color: #fff;
    transition: 0.2s;
    pointer-events: none;
}

.auto-seg-slider:after {
    position: absolute;
    content: "off";
    height: 24px;
    width: 24px;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    transition: 0.2s;
    pointer-events: none;
    display: flex;
    align-items: center;
    color: white;
}

.auto-seg-toggle-container input:checked + .auto-seg-slider {
    background-color: #2196f3;
}

.auto-seg-toggle-container input:checked + .auto-seg-slider:before {
    transform: translateX(40px);
}

.auto-seg-toggle-container input:checked + .auto-seg-slider:after {
    content: "on";
    left: 8px;
    right: auto;
    color: white;
}

.auto-seg-slider.auto-seg-round {
    border-radius: 34px;
}

.auto-seg-slider.auto-seg-round:before {
    border-radius: 50%;
}

/* History panel custom scrollbar */
#historyList::-webkit-scrollbar {
    width: 6px;
}

#historyList::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#historyList::-webkit-scrollbar-thumb {
    background: #c4c4c4;
    border-radius: 3px;
}

#historyList::-webkit-scrollbar-thumb:hover {
    background: #999;
}

#historyList {
    min-height: 100px;
}

/* Floating action buttons */
.floating-action-btn {
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.floating-action-btn:not(:disabled):hover {
    transform: scale(1.1);
}

.floating-action-btn:not(:disabled):active {
    transform: scale(0.95);
}
    </style>
</body>
</html>
